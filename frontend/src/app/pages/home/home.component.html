<main class="home-page">
  <!-- Hero Carousel Section -->
  <section class="hero-carousel" aria-label="Featured architectural projects">
    <div class="carousel-container">
      <div class="carousel-slide" *ngFor="let image of homepageImages; let i = index"
        [class.active]="i === currentSlideIndex">
        <img [src]="image" [alt]="'Homepage image ' + (i + 1)" (error)="onImageError($event, image)"
          (load)="onImageLoad($event, image)" style="width: 100%; height: 100%; object-fit: cover;">
      </div>

      <!-- Carousel Navigation -->
      <div class="carousel-nav" *ngIf="homepageImages.length > 1">
        <button class="carousel-prev" (click)="previousSlide()" [disabled]="homepageImages.length <= 1">
          <mat-icon>chevron_left</mat-icon>
        </button>
        <button class="carousel-next" (click)="nextSlide()" [disabled]="homepageImages.length <= 1">
          <mat-icon>chevron_right</mat-icon>
        </button>
      </div>

      <!-- Carousel Indicators -->
      <div class="carousel-indicators" *ngIf="homepageImages.length > 1">
        <button *ngFor="let image of homepageImages; let i = index" class="indicator"
          [class.active]="i === currentSlideIndex" (click)="goToSlide(i)">
        </button>
      </div>
    </div>
  </section>

  <!-- Hero Content Section - Separate section between carousel and main-categories -->
  <section class="hero-content-section" aria-label="Company introduction">
    <div class="container">
      <header class="hero-content">
        <h1>{{ homeContent?.hero_title || 'MMA Architectural Design' }}</h1>
        <p>{{ homeContent?.hero_description || 'Chuyên thiết kế và thi công biệt thự, nhà ở hiện đại với phong cách kiến
          trúc độc đáo' }}</p>
        <div class="hero-stats">
          <div class="stat-item">
            <div class="stat-number">{{ homeContent?.hero_stat1_number || '37' }}</div>
            <div class="stat-label">{{ homeContent?.hero_stat1_label || 'Tỉnh Thành Phủ Sóng' }}</div>
          </div>
          <div class="stat-item">
            <div class="stat-number">{{ homeContent?.hero_stat2_number || '500+' }}</div>
            <div class="stat-label">{{ homeContent?.hero_stat2_label || 'Dự Án Biệt Thự/Nhà Ở Chuyên Nghiệp' }}</div>
          </div>
        </div>
        <div class="hero-buttons">
          <button mat-raised-button class="btn-primary">
            Khám Phá Dự Án
          </button>
          <button mat-stroked-button class="btn-outline">
            Liên Hệ Tư Vấn
          </button>
        </div>
      </header>
    </div>
  </section>

  <!-- Main Categories Section -->
  <section class="main-categories" aria-label="Service categories">
    <div class="container">
      <h2 class="section-title text-center">Danh Mục Chính</h2>
      <div class="categories-grid" *ngIf="mainCategories$ | async as mainCategories">
        <div class="category-item" *ngFor="let category of mainCategories" [routerLink]="'/category/' + category.slug">
          <div class="category-image">
            <img *ngIf="category.thumbnail_url" [src]="category.thumbnail_url" [alt]="category.name"
              class="category-thumbnail" (error)="onImageError($event)">
            <div *ngIf="!category.thumbnail_url" class="category-image-placeholder"></div>
          </div>
          <div class="category-content">
            <h3>{{ category.name }}</h3>
            <p>{{ category.description || 'Khám phá các thiết kế trong danh mục này' }}</p>
          </div>
        </div>
      </div>
      <!-- Loading state for main categories -->
      <div class="loading-state" *ngIf="isLoadingCategories">
        <div class="loading-spinner"></div>
        <p>Đang tải danh mục...</p>
      </div>
      <!-- Empty state if no main categories -->
      <div class="no-categories" *ngIf="!(mainCategories$ | async)?.length && !isLoadingCategories">
        <mat-icon class="no-categories-icon">category</mat-icon>
        <h3>Chưa có danh mục nào</h3>
        <p>Hiện tại chưa có danh mục thiết kế nào được tạo.</p>
      </div>
    </div>
  </section>

  <!-- Features Section -->
  <section class="features-section" aria-label="Company advantages">
    <div class="container">
      <h2 class="section-title text-center">{{ homeContent?.features_title || 'Ưu Thế MMA Architectural Design' }}</h2>
      <div class="features-strips">
        <div class="feature-strip left-aligned">
          <div class="feature-content">
            <div class="feature-icon-container">
              <mat-icon *ngIf="isMatIcon(homeContent?.feature1_icon || 'architecture')" class="feature-icon">{{ homeContent?.feature1_icon || 'architecture' }}</mat-icon>
              <img *ngIf="!isMatIcon(homeContent?.feature1_icon || 'architecture')" [src]="homeContent?.feature1_icon || 'architecture'" class="feature-icon custom-svg" alt="Feature icon">
            </div>
            <div class="feature-text">
              <h3>{{ homeContent?.feature1_title || 'Thiết Kế Kiến Trúc Độc Đáo' }}</h3>
              <p>{{ homeContent?.feature1_description || 'Chuyên gia kiến trúc sư với hơn 10 năm kinh nghiệm, tạo ra những công trình biệt thự và nhà ở đẳng cấp.' }}
              </p>
            </div>
          </div>
        </div>
        <div class="feature-strip right-aligned">
          <div class="feature-content">
            <div class="feature-text">
              <h3>{{ homeContent?.feature2_title || 'Thi Công Chất Lượng Cao' }}</h3>
              <p>{{ homeContent?.feature2_description || 'Đội ngũ kỹ sư và công nhân tay nghề cao, sử dụng công nghệ hiện đại trong thi công.' }}</p>
            </div>
            <div class="feature-icon-container">
              <mat-icon *ngIf="isMatIcon(homeContent?.feature2_icon || 'engineering')" class="feature-icon">{{ homeContent?.feature2_icon || 'engineering' }}</mat-icon>
              <img *ngIf="!isMatIcon(homeContent?.feature2_icon || 'engineering')" [src]="homeContent?.feature2_icon || 'engineering'" class="feature-icon custom-svg" alt="Feature icon">
            </div>
          </div>
        </div>
        <div class="feature-strip left-aligned">
          <div class="feature-content">
            <div class="feature-icon-container">
              <mat-icon *ngIf="isMatIcon(homeContent?.feature3_icon || 'business')" class="feature-icon">{{ homeContent?.feature3_icon || 'business' }}</mat-icon>
              <img *ngIf="!isMatIcon(homeContent?.feature3_icon || 'business')" [src]="homeContent?.feature3_icon || 'business'" class="feature-icon custom-svg" alt="Feature icon">
            </div>
            <div class="feature-text">
              <h3>{{ homeContent?.feature3_title || 'Dịch Vụ Toàn Diện' }}</h3>
              <p>{{ homeContent?.feature3_description || 'Từ thiết kế kiến trúc, nội thất đến giám sát thi công và bàn giao hoàn thiện.' }}</p>
            </div>
          </div>
        </div>
        <div class="feature-strip right-aligned">
          <div class="feature-content">
            <div class="feature-text">
              <h3>{{ homeContent?.feature4_title || 'Uy Tín 37 Tỉnh Thành' }}</h3>
              <p>{{ homeContent?.feature4_description || 'Đã hoàn thành hơn 500 dự án biệt thự và nhà ở trên toàn quốc, được khách hàng tin tưởng.' }}</p>
            </div>
            <div class="feature-icon-container">
              <mat-icon *ngIf="isMatIcon(homeContent?.feature4_icon || 'verified')" class="feature-icon">{{ homeContent?.feature4_icon || 'verified' }}</mat-icon>
              <img *ngIf="!isMatIcon(homeContent?.feature4_icon || 'verified')" [src]="homeContent?.feature4_icon || 'verified'" class="feature-icon custom-svg" alt="Feature icon">
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Dynamic Categories Section -->
  <section class="dynamic-categories-section" aria-label="Project categories">
    <div class="container">
      <div class="category-group" *ngFor="let category of mainCategories$ | async">
        <h2 class="section-title text-center">{{ category.name }}</h2>

        <!-- DEBUG INFO - Remove after fixing -->
        <div style="background: #f0f0f0; padding: 10px; margin: 10px 0; font-size: 12px;">
          <strong>DEBUG:</strong> Type: {{ category.category_type }} |
          Children: {{ category.children?.length || 0 }} |
          Has Children: {{ category.children ? 'YES' : 'NO' }} |
          Children Array: {{ category.children | json }}
        </div>

        <!-- For parent categories: show subcategories -->
        <div class="subcategories-grid" *ngIf="category.category_type === 'parent' && category.children && category.children.length > 0">
          <mat-card class="subcategory-card" *ngFor="let subcategory of category.children.slice(0, 3)"
            [routerLink]="'/category/' + subcategory.slug">
            <div class="subcategory-image">
              <div class="subcategory-image-placeholder" *ngIf="!subcategory.thumbnail_url"></div>
              <img *ngIf="subcategory.thumbnail_url" [src]="subcategory.thumbnail_url" [alt]="subcategory.name"
                (error)="onImageError($event)">
            </div>
            <mat-card-content class="subcategory-content">
              <h3 class="subcategory-title">{{ subcategory.name }}</h3>
              <p class="subcategory-description">{{ subcategory.description || 'Khám phá các thiết kế trong danh mục
                này' }}</p>
            </mat-card-content>
          </mat-card>
        </div>

        <!-- For regular categories: show recent posts -->
        <div class="category-posts-grid" *ngIf="category.category_type === 'regular'">
          <mat-card class="post-card" *ngFor="let post of getCategoryPosts(category.id).slice(0, 3)"
            [routerLink]="'/post/' + post.id">
            <div class="post-image">
              <div class="post-image-placeholder" *ngIf="!post.image_url"></div>
              <img *ngIf="post.image_url" [src]="post.image_url" [alt]="post.title" (error)="onImageError($event)">
              <div class="post-overlay">
                <div class="post-category">{{ category.name }}</div>
              </div>
            </div>
            <mat-card-content class="post-content">
              <h3 class="post-title">{{ post.title }}</h3>
              <p class="post-summary">{{ post.summary || 'Không có mô tả' }}</p>
              <div class="post-meta">
                <div class="meta-item">
                  <mat-icon>event</mat-icon>
                  <span class="post-date">{{ post.created_at | date:'dd/MM/yyyy HH:mm' }}</span>
                </div>
                <div class="meta-item" *ngIf="!(currentUser$ | async)">
                  <mat-icon>visibility</mat-icon>
                  <span>{{ post.views || 0 }} lượt xem</span>
                </div>
              </div>
              <div class="read-more">
                <span>Xem chi tiết</span>
                <mat-icon>arrow_forward</mat-icon>
              </div>
            </mat-card-content>
          </mat-card>
        </div>

        <!-- View all button -->
        <div class="text-center mt-4" *ngIf="(category.children && category.children.length > 0) || getCategoryPosts(category.id).length > 0">
          <button mat-raised-button [routerLink]="'/category/' + category.slug" class="btn-primary view-all-btn">
            <mat-icon>view_list</mat-icon>
            Xem Tất Cả {{ category.name }}
          </button>
        </div>
      </div>
    </div>
  </section>

</main>