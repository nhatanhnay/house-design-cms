<mat-toolbar class="navbar dark-bg">
  <div class="container navbar-content">
    <div class="brand">
      <a routerLink="/" class="brand-link">
        <mat-icon>home</mat-icon>
        <span class="brand-text">MMA Architectural Design</span>
      </a>
    </div>

    <nav class="nav-links">
      <a mat-button routerLink="/" routerLinkActive="active" [routerLinkActiveOptions]="{exact: true}">
        Trang Chủ
      </a>

      <!-- Main Categories with Pure CSS Hover Dropdowns -->
      <div class="nav-category-wrapper" *ngFor="let mainCategory of mainCategories"
        [class.has-dropdown]="mainCategory.hasChildren">

        <!-- Category with subcategories - CSS hover dropdown -->
        <div *ngIf="mainCategory.hasChildren" class="category-dropdown-container">
          <button mat-button class="category-dropdown" [routerLink]="'/category/' + mainCategory.slug">
            {{ mainCategory.name }}
            <mat-icon class="dropdown-arrow">keyboard_arrow_down</mat-icon>
          </button>

          <!-- Pure CSS Dropdown Menu -->
          <div class="dropdown-menu">
            <a *ngFor="let subcategory of mainCategory.children" [routerLink]="'/category/' + subcategory.slug"
              class="dropdown-item">
              <mat-icon>{{ getCategoryIcon(subcategory.slug) }}</mat-icon>
              <span>{{ subcategory.name }}</span>
            </a>
          </div>
        </div>

        <!-- Category without subcategories - direct link -->
        <a mat-button *ngIf="!mainCategory.hasChildren" [routerLink]="'/category/' + mainCategory.slug"
          routerLinkActive="active">
          {{ mainCategory.name }}
        </a>
      </div>

      <!-- Debug info - remove this later -->
      <div *ngIf="mainCategories.length === 0" style="color: white; padding: 10px;">
        Loading categories... ({{mainCategories.length}} loaded)
      </div>

      <a mat-button routerLink="/admin" *ngIf="currentUser$ | async" class="admin-link">
        <mat-icon>admin_panel_settings</mat-icon>
        Quản Trị
      </a>

      <button mat-button *ngIf="currentUser$ | async" (click)="logout()" class="logout-btn">
        <mat-icon>logout</mat-icon>
        Đăng Xuất
      </button>
    </nav>

    <!-- Mobile menu button -->
    <div class="mobile-menu-container">
      <button mat-icon-button class="mobile-menu-btn" (click)="toggleMobileMenu()">
        <mat-icon>menu</mat-icon>
      </button>

      <!-- Mobile menu overlay -->
      <div class="mobile-menu-overlay" [class.active]="isMobileMenuOpen" (click)="closeMobileMenu()"></div>

      <!-- Mobile menu -->
      <div class="mobile-menu" [class.active]="isMobileMenuOpen">
        <div class="mobile-menu-header">
          <span>Menu</span>
          <button mat-icon-button (click)="closeMobileMenu()">
            <mat-icon>close</mat-icon>
          </button>
        </div>

        <div class="mobile-menu-content">
          <a class="mobile-menu-item" routerLink="/" (click)="closeMobileMenu()">
            <mat-icon>home</mat-icon>
            <span>Trang Chủ</span>
          </a>

          <!-- Mobile menu with hierarchical categories -->
          <ng-container *ngFor="let mainCategory of mainCategories">
            <!-- Main category header -->
            <div class="mobile-category-header" *ngIf="mainCategory.hasChildren">
              <mat-icon>{{ getCategoryIcon(mainCategory.slug) }}</mat-icon>
              <span class="category-header-text">{{ mainCategory.name }}</span>
            </div>

            <!-- Subcategories -->
            <a *ngFor="let subcategory of mainCategory.children" [routerLink]="'/category/' + subcategory.slug"
              class="mobile-menu-item mobile-subcategory" (click)="closeMobileMenu()">
              <mat-icon class="subcategory-icon">{{ getCategoryIcon(subcategory.slug) }}</mat-icon>
              <span>{{ subcategory.name }}</span>
            </a>

            <!-- Direct link if no children -->
            <a *ngIf="!mainCategory.hasChildren" [routerLink]="'/category/' + mainCategory.slug"
              class="mobile-menu-item" (click)="closeMobileMenu()">
              <mat-icon>{{ getCategoryIcon(mainCategory.slug) }}</mat-icon>
              <span>{{ mainCategory.name }}</span>
            </a>

            <div class="mobile-menu-divider" *ngIf="mainCategory.hasChildren"></div>
          </ng-container>

          <div class="mobile-menu-divider" *ngIf="currentUser$ | async"></div>

          <a class="mobile-menu-item" routerLink="/admin" *ngIf="currentUser$ | async" (click)="closeMobileMenu()">
            <mat-icon>admin_panel_settings</mat-icon>
            <span>Quản Trị</span>
          </a>

          <button class="mobile-menu-item mobile-menu-btn-item" *ngIf="currentUser$ | async"
            (click)="logout(); closeMobileMenu()">
            <mat-icon>logout</mat-icon>
            <span>Đăng Xuất</span>
          </button>
        </div>
      </div>
    </div>
  </div>
</mat-toolbar>